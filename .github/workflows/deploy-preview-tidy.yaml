name: Tidy Deploy Preview Environment

on:
  schedule:
    # Runs "daily at 7:45 PM ET" (see https://crontab.guru)
    - cron: '45 0 * * *'

jobs:
  clean-environments:
    name: Clean Deployments
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: volta-cli/action@v3
      - run: yarn
      - name: Create Environment
        run: ./.scripts/humanitec.mjs tidy-previews
        env:
          HUMANITEC_ORG_ID: ${{ secrets.HUMANITEC_ORG_ID }}
          HUMANITEC_TOKEN: ${{ secrets.HUMANITEC_TOKEN }}
